#!/bin/bash
source $(dirname "$0")/util/getConfig.sh

LD_USER=laradock
LD_SHELL=bash
LD_CONTAINER_CWD=""
LD_COMMAND=""

source $(dirname "$0")/util/parseArguments.sh

if [ -n "$LD_CONTAINER_CWD" ]; then
    # use given cwd
    working_dir=$LD_CONTAINER_CWD
else
    # if no cwd is given, try to guess
    getEnvVariable "APP_CODE_PATH_HOST" code_path_host
    getEnvVariable "APP_CODE_PATH_CONTAINER" code_path_container
    host_cwd=$(pwd)
    project_path=${host_cwd/$code_path_host}

    if [ -d $code_path_host/$project_path ]; then
        # if user is in a directory under APP_CODE_PATH_HOST, go into that directory in the container
        working_dir=$code_path_container/$project_path
    else
        # if cwd can not be guessed, go to APP_CODE_PATH_CONTAINER
        working_dir=$code_path_container
    fi
fi

eval "laradock --user=\"$LD_USER\" --command=\"$LD_COMMAND\" --shell=\"$LD_SHELL\" --container=workspace $working_dir"
